define("handy/base/1.1.0/page",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","./path","./navigation","./history"],function(a){var b,c=a("$"),d=a("arale/base/1.1.1/base"),e=a("./path"),f=a("./navigation"),g=c(window),h=d.extend({attrs:{easeout:"page-slideoutleft",easein:"page-slideinright",easeoutreverse:"page-slideoutright",easeinreverse:"page-slideinleft"},init:function(){this._initPages(),this._initEvents()},_initPages:function(){var a=this.pages=[];c.each(c(".page"),function(b,d){if(0===b)a.push({url:e.parseUrl(e.documentUrl.hrefNoHash),dom:c(d),title:document.title});else{var f=c(d).data("url");f&&a.push({url:e.parseUrl(e.makeUrlAbsolute(f)),dom:c(d),title:c(d).data("title")})}}),this.activePage=this.pages[0]},_initEvents:function(){var a=this;g.on("navigate",function(b,c){var d=c.state,f=e.parseUrl(e.squash(location.href));f.hrefNoHash,"forward"===d.direction?a.forward(f):a.backward(f)}),c(document).on("click","[data-transition]",function(b){b.preventDefault(),a.forward(this.href)}),c(document).on("click","[data-rel=back]",function(a){a.preventDefault(),window.history.back()}),g.trigger("hashchange")},forward:function(a,b,d){if(!this.transiting&&a){this.transiting=!0;var f,g="object"===c.type(a)?a:e.parseUrl(e.squash(e.makeUrlAbsolute(a)));(f=this._getIndexByUrl(g))<0?this._createPage({url:g,data:b,post:d}):this.transition(this.pages[f])}},backward:function(a,b,d){if(!this.transiting)if(a){this.transiting=!0;var f,g="object"===c.type(a)?a:e.parseUrl(e.squash(e.makeUrlAbsolute(a)));(f=this._getIndexByUrl(g))<0?this._createPage({url:g,data:b,post:d},!0):this.transition(this.pages[f],!0)}else window.history.back()},transition:function(a,b){if(a!==this.activePage){var c=this,d=a.url,e=a.dom,g=this.activePage,h=g.dom,i=g.url,j=b?this.get("easeoutreverse"):this.get("easeout"),k=b?this.get("easeinreverse"):this.get("easein");c.trigger("transiting"),a.title&&(document.title=a.title),h.on("animationend webkitAnimationEnd",function(a){h.removeClass("page-active "+j).off("animationend webkitAnimationEnd",a.callee),h.data("cache")===!1&&(c.pages.splice(c._getIndexByUrl(i),1),h.remove())}).addClass(j),e.on("animationend webkitAnimationEnd",function(b){e.removeClass(k).off("animationend webkitAnimationEnd",b.callee),c.activePage=a,c.transiting=!1,c.trigger("transition",a),window.scrollTo(0,0)}).addClass("page-active "+k),f.go(d,b)}},_getIndexByUrl:function(a){for(var b=this.pages,c=0,d=b.length;d>c;c++)if(a.hrefNoHash===b[c].url.hrefNoHash)return c;return-1},_createPage:function(a,b){this.trigger("loading"),c.ajax(a.url.href,{type:a.post?"post":"get",data:a.data,context:this,success:function(d){var e,f,g,h,i=c("<div></div>"),j=this.pages;e=d.match(/<title[^>]*>([^<]*)/)&&RegExp.$1,f=d.match(/<body[^>]*>([\s\S]*)<\/body>/gim)&&RegExp.$1,i.get(0).innerHTML=f,g=i.find("[data-role=page]").eq(0),a.post&&g.data("cache",!1),this.activePage.dom.after(g),h={url:a.url,dom:g,title:e},this.trigger("load",h),b?(j.unshift(h),this.transition(h,!0)):(j.push(h),this.transition(h))},error:function(){this.trigger("error",a),this.transiting=!1}})}});return b=new h}),define("handy/base/1.1.0/path",["$"],function(a){var b=a("$"),c=b("head").find("base"),d={urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(a){var b=a?this.parseUrl(a):location,c=this.parseUrl(a||location.href).hash;return c="#"===c?"":c,b.protocol+"//"+b.host+b.pathname+b.search+c},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(a){if("object"===b.type(a))return a;var c=d.urlParseRE.exec(a||"")||[];return{href:c[0]||"",hrefNoHash:c[1]||"",hrefNoSearch:c[2]||"",domain:c[3]||"",protocol:c[4]||"",doubleSlash:c[5]||"",authority:c[6]||"",username:c[8]||"",password:c[9]||"",host:c[10]||"",hostname:c[11]||"",port:c[12]||"",pathname:c[13]||"",directory:c[14]||"",filename:c[15]||"",search:c[16]||"",hash:c[17]||""}},makePathAbsolute:function(a,b){if(a&&"/"===a.charAt(0))return a;a=a||"",b=b?b.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"";for(var c=b?b.split("/"):[],d=a.split("/"),e=0;e<d.length;e++){var f=d[e];switch(f){case".":break;case"..":c.length&&c.pop();break;default:c.push(f)}}return"/"+c.join("/")},isSameDomain:function(a,b){return d.parseUrl(a).domain===d.parseUrl(b).domain},isRelativeUrl:function(a){return""===d.parseUrl(a).protocol},isAbsoluteUrl:function(a){return""!==d.parseUrl(a).protocol},makeUrlAbsolute:function(a,b){if(!d.isRelativeUrl(a))return a;void 0===b&&(b=this.documentBase);var c=d.parseUrl(a),e=d.parseUrl(b),f=c.protocol||e.protocol,g=c.protocol?c.doubleSlash:c.doubleSlash||e.doubleSlash,h=c.authority||e.authority,i=""!==c.pathname,j=d.makePathAbsolute(c.pathname||e.filename,e.pathname),k=c.search||!i&&e.search||"",l=c.hash;return f+g+h+j+k+l},addSearchParams:function(a,c){var e=d.parseUrl(a),f="object"==typeof c?b.param(c):c,g=e.search||"?";return e.hrefNoSearch+g+("?"!==g.charAt(g.length-1)?"&":"")+f+(e.hash||"")},get:function(a){return void 0===a&&(a=d.parseLocation().hash),d.stripHash(a).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(a){location.hash=a},isPath:function(a){return/\//.test(a)},clean:function(a){return a.replace(this.documentBase.domain,"")},stripHash:function(a){return a.replace(/^#/,"")},stripQueryParams:function(a){return a.replace(/\?.*$/,"")},cleanHash:function(a){return d.stripHash(a.replace(/\?.*$/,""))},isHashValid:function(a){return/^#[^#]+$/.test(a)},isExternal:function(a){var b=d.parseUrl(a);return b.protocol&&b.domain!==this.documentUrl.domain?!0:!1},hasProtocol:function(a){return/^(:?\w+:)/.test(a)},squash:function(a,b){var c,e,f,g=this.isPath(a),h=this.parseUrl(a),i=h.hash;return b=b||(d.isPath(a)?d.getLocation():d.getDocumentUrl()),e=g?d.stripHash(a):a,e=d.isPath(h.hash)?d.stripHash(h.hash):e,c=d.makeUrlAbsolute(e,b),f=this.parseUrl(c).search,g&&(d.isPath(i)&&(i=""),-1===i.indexOf("#")&&""!==i&&(i="#"+i),c=d.parseUrl(c),c=c.protocol+"//"+c.host+c.pathname+f+i),c}};return d.documentUrl=d.parseLocation(),d.documentBase=c.length?d.parseUrl(d.makeUrlAbsolute(c.attr("href"),d.documentUrl.href)):d.documentUrl,d.documentBaseDiffers=d.documentUrl.hrefNoHash!==d.documentBase.hrefNoHash,d.getDocumentUrl=function(a){return a?b.extend({},d.documentUrl):d.documentUrl.href},d.getDocumentBase=function(a){return a?b.extend({},d.documentBase):d.documentBase.href},d}),define("handy/base/1.1.0/navigation",["$","handy/base/1.1.0/path","handy/base/1.1.0/history"],function(a){var b,c=a("$"),d=a("handy/base/1.1.0/path"),e=a("handy/base/1.1.0/history"),f=c(window),g={currentHref:d.documentBase.hrefNoHash,go:function(a,b){var c=e.find(a.hrefNoHash);d.documentBase.hrefNoHash===a.hrefNoHash?d.set("#"):d.set("#"+a.pathname),0>c&&(b||e.clearForward(this.currentHref),e.add(a.hrefNoHash,b)),this.currentHref=a.hrefNoHash}};return f.on("hashchange",function(){var a=d.parseUrl(d.squash(location.href)).hrefNoHash;if(a===g.currentHref){if(b)return;e.add(a),b=!0}else{var f=e.find(g.currentHref),h=e.find(a);c(this).trigger("navigate",{state:{direction:h>-1&&f>h?"backward":"forward"}})}}),g}),define("handy/base/1.1.0/history",["$"],function(a){function b(){this._stack=[]}var c=a("$");return window.undefined,c.extend(b.prototype,{add:function(a,b){this._stack[b?"unshift":"push"](a)},clearForward:function(a){this._stack=this._stack.slice(0,this.find(a)+1)},find:function(a){return this._stack.indexOf(a)}}),new b});
